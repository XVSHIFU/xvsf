<!-- ========================================== -->
<!-- 1. 代码块折叠与复制功能 (保持不变) -->
<!-- ========================================== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 恢复：点击整个 code header 区域也可折叠/展开（保留 toggle-btn 的独立行为）
    document.querySelectorAll('.code-header').forEach(header => {
        header.addEventListener('click', (e) => {
            // 点击复制按钮不触发折叠
            if (e.target.closest('.copy-btn')) return;
            // 如果点击的是 toggle-btn，交由 toggle-btn 自己处理（它会 stopPropagation）
            if (e.target.closest('.toggle-btn')) return;
            const container = header.parentElement;
            const isExpanded = container.getAttribute('data-expanded') === 'true';
            const next = !isExpanded;
            container.setAttribute('data-expanded', next);
            container.setAttribute('aria-expanded', next);
            const toggle = container.querySelector('.toggle-btn');
            if (toggle) toggle.setAttribute('aria-expanded', String(next));
        });
    });

    // 处理折叠功能：保留 toggle 按钮的专属监听（防止事件冒泡导致冲突）
    document.querySelectorAll('.code-block-container .toggle-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const container = btn.closest('.code-block-container');
            const isExpanded = container.getAttribute('data-expanded') === 'true';
            const next = !isExpanded;
            container.setAttribute('data-expanded', next);
            container.setAttribute('aria-expanded', next);
            // 同步按钮的 aria-expanded
            btn.setAttribute('aria-expanded', String(next));
        });
    });

    // 处理复制功能，提供 navigator.clipboard 的降级方案
    document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
            e.stopPropagation();
            const container = btn.closest('.code-block-container');
            const codeEl = container && container.querySelector('code');
            const code = codeEl ? codeEl.innerText : '';
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(code);
                } else {
                    const ta = document.createElement('textarea');
                    ta.value = code;
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    ta.remove();
                }
                const originalLabel = btn.getAttribute('aria-label') || '';
                btn.setAttribute('aria-label', '已复制');
                setTimeout(() => btn.setAttribute('aria-label', originalLabel), 2000);
            } catch (err) {
                console.error('Failed to copy!', err);
            }
        });
    });
});
</script>

<!-- ========================================== -->
<!-- 2. 本地化樱花特效 (无外部依赖，肯定能用) -->
<!-- ========================================== -->
<script>
(function() {
    // --- 配置区域 ---
    const STOP_TIME = 15000; // 15秒后停止
    const NUMBER_OF_LEAVES = 30; // 同时飘落的樱花数量 (不要太多，否则卡)
    
    // 只有在屏幕宽度大于 768px (电脑端) 时运行，避免手机端遮挡内容
    if (window.innerWidth < 768) return;

    var container = document.createElement('div');
    container.id = "sakura-container";
    container.style.position = 'fixed';
    container.style.top = '0';
    container.style.left = '0';
    container.style.width = '100%';
    container.style.height = '100%';
    container.style.pointerEvents = 'none'; // 让樱花不挡鼠标点击
    container.style.zIndex = '9999';
    document.body.appendChild(container);

    function createLeaf() {
        var leaf = document.createElement('div');
        // 使用 CSS 绘制樱花瓣 (粉色椭圆)
        leaf.style.position = 'absolute';
        leaf.style.width = (Math.random() * 10 + 10) + 'px'; // 10~20px
        leaf.style.height = (Math.random() * 5 + 5) + 'px';
        leaf.style.background = 'linear-gradient(to bottom right, #ffc0cb, #ffb6c1)';
        leaf.style.borderRadius = '10px 0'; // 樱花形状
        leaf.style.opacity = Math.random() * 0.5 + 0.3;
        leaf.style.top = '-20px';
        leaf.style.left = Math.random() * 100 + '%';
        
        // 动画参数
        var duration = Math.random() * 5 + 5 + 's'; // 5~10秒飘落时间
        var delay = Math.random() * 5 + 's';
        
        leaf.style.transition = `top ${duration} linear, transform ${duration} ease-in-out, opacity ${duration}`;
        container.appendChild(leaf);

        // 强制回流触发动画
        setTimeout(function() {
            leaf.style.top = '110%'; // 飘到底部
            leaf.style.transform = `rotate(${Math.random() * 360}deg) translateX(${Math.random() * 100 - 50}px)`;
            leaf.style.opacity = '0';
        }, 100);

        // 动画结束后移除元素
        setTimeout(function() {
            leaf.remove();
        }, parseFloat(duration) * 1000 + 1000);
    }

    // 开始生成樱花
    var interval = setInterval(function() {
        if (document.getElementById('sakura-container')) {
            createLeaf();
        }
    }, 400); // 每0.4秒生成一片

    // --- 定时停止逻辑 ---
    setTimeout(function() {
        clearInterval(interval); // 停止生成新樱花
        
        // 现有的樱花让它飘完，然后移除容器
        setTimeout(function() {
            if(container) container.remove();
            console.log("樱花已落尽。");
        }, 10000); // 给10秒缓冲时间让剩下的飘完
        
    }, STOP_TIME);

})();
</script>